@using MusicGenMVC.Models
@model IEnumerable<SongItem>
@{
    var p = (GenerationParams)ViewBag.Params;
    var pageNum = (int)ViewBag.Page;      // use pageNum to avoid @page directive collision
    var size = (int)ViewBag.PageSize;
    var total = (int)ViewBag.Total;
}

<div class="d-flex flex-wrap gap-3" id="gal">
    @foreach (var s in Model)
    {
        <div class="card song-card" data-index="@s.Index">
            <img class="card-img-top cover"
                 src="/media/cover?lang=@p.Lang&seed=@p.Seed&page=@pageNum&index=@s.Index&title=@Uri.EscapeDataString(s.Title)&artist=@Uri.EscapeDataString(s.Artist)" />
            <div class="card-body">
                <div class="fw-bold">@s.Title</div>
                <div class="text-muted">@s.Artist</div>
                <div class="small">@s.Album • @s.Genre</div>
                <div class="small">❤️ @s.Likes</div>
                <audio class="w-100 mt-1"
                       controls
                       src="/media/audio?lang=@p.Lang&seed=@p.Seed&page=@pageNum&index=@s.Index"></audio>
            </div>
        </div>
    }
</div>

@{
    var last = (int)Math.Ceiling(total / (double)size);
}
<nav class="mt-3">
    <ul class="pagination justify-content-center">
        <li class="page-item @(pageNum <= 1 ? "disabled" : "")">
            <a class="page-link gal-page" data-page="@(pageNum - 1)">Previous</a>
        </li>
        @for (int i = 1; i <= last; i++)
        {
            <li class="page-item @(i == pageNum ? "active" : "")">
                <a class="page-link gal-page" data-page="@i">@i</a>
            </li>
        }
        <li class="page-item @(pageNum >= last ? "disabled" : "")">
            <a class="page-link gal-page" data-page="@(pageNum + 1)">Next</a>
        </li>
    </ul>
</nav>
